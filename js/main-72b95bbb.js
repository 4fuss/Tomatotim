var config=function(){"use strict";var e=!1;window.location.search.indexOf("debug")>-1&&(e=!0);var t=document.title,i=!1,n=!1,r=1500,o=300,s=1200,a=4;return e&&(i=!0,n=!0,r=10,o=5,s=5,a=3,t="DEBUG"),{debug:e,appName:t,audio:i,notifications:n,workInterval:r,breakInterval:o,longbreakInterval:s,repeat:a}}(),services={},views={};services.storage=function(){"use strict";var e=function(e){return JSON.parse(localStorage.getItem(e))},t=function(e,t){localStorage.setItem(e,JSON.stringify(t))},i=function(){localStorage.clear()};return{set:t,get:e,clear:i}}();var browserDetection=function(){"use strict";var e=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,t="undefined"!=typeof InstallTrigger,i=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,n=!!window.chrome&&!e,r=!1||!!document.documentMode;return{isOpera:e,isFirefox:t,isSafari:i,isChrome:n,isIE:r}}();services.title=function(){"use strict";var e=function(e,t){var i="";t||(i="■ "),document.title=i+e+" – "+config.appName},t=function(){document.title=config.appName};return{setTitle:e,resetTitle:t}}(),services.favicon=function(){"use strict";var e=document.getElementById("favicon-ico"),t=function(){if(browserDetection.isIE)for(var e=document.querySelectorAll("[data-favicon-explorer]"),t=0;t<e.length;t++)document.head.removeChild(e[t])},i=function(t){if(browserDetection.isFirefox||browserDetection.isIE)e.rel="shortcut icon",e.href="icons/favicon-"+t+".ico",e.id="favicon-ico";else{e=document.createElement("link");var i=document.getElementById("favicon-png");e.rel="icon",e.setAttribute("type","image/png"),e.href="icons/favicon-16x16-"+t+".png",e.setAttribute("sizes","16x16"),e.id="favicon-png",i&&document.head.removeChild(i),document.head.appendChild(e)}};return{init:t,setFavicon:i}}(),services.notification=function(){"use strict";var e=5,t=function(){return window.Notification?"granted"!==Notification.permission?(Notification.requestPermission(),!1):!0:!1},i=function(i,n){if(t()){var r=new Notification(config.appName,{icon:"icons/favicon-"+n+".ico",body:i});r.onshow=function(){setTimeout(function(){r.close()},1e3*e)}}};return{requestPermission:t,newNotification:i}}(),services.audio=function(){"use strict";var e,t=function(){e=document.createElement("audio"),e.src="audio/ding.mp3"},i=function(){e.play()},n=function(t){1>=t&&t>=0||(t=1),e.volume=t};return{init:t,play:i,setVolume:n}}(),views.timer=function(){"use strict";var e=document.getElementById("clock"),t=function(){return e.innerHTML.trim()},i=function(t){e.innerHTML=t};return{getTime:t,setTime:i}}(),views.progress=function(){"use strict";var e=document.getElementById("progress"),t=e.getElementsByTagName("i"),i=document.getElementById("description"),n={unfinished:"Unfinished interval",work:"Work interval","break":"Break interval",longbreak:"Long break interval",finished:"Finished interval"},r=function(e,i){t[i].className="icon-tomato color-"+e,t[i].title=n[e]},o=function(){c("");for(var e=0;e<t.length;e++)r("unfinished",e)},s=function(t){var i=document.createElement("i");i.className="icon-tomato color-"+t,i.title=n[t],e.appendChild(i)},a=function(){for(;e.firstChild;)e.removeChild(e.firstChild)},c=function(e){i.innerHTML=e};return{setDescription:c,setImageType:r,resetProgress:o,createImage:s,removeImages:a}}(),views.controls=function(){"use strict";var e=!0,t=document.getElementById("start"),i=document.getElementById("reset"),n=document.getElementById("skip"),r=document.getElementById("start-icon"),o=document.getElementById("start-caption"),s=function(){e?(o.innerHTML="pause",r.className="icon-pause-1"):(o.innerHTML="start",r.className="icon-play-1"),e=!e},a=function(){e||s()},c=function(){return t},v=function(){return i},u=function(){return n};return{getStartButton:c,getResetButton:v,getSkipButton:u,resetStartButton:a,toogleStartButtonCaption:s}}(),views.sidebar=function(){"use strict";var e=!1,t=document.getElementById("sidebar-button"),i=document.getElementById("sidebar-overlay"),n=function(){return i},r=function(){return t},o=function(){e||(document.body.setAttribute("data-sidebar-open",""),e=!0)},s=function(){e&&(document.body.removeAttribute("data-sidebar-open"),e=!1)},a=function(){e?s():o()},c=function(){return e};return{getSidebarOverlay:n,getSidebarButton:r,isSidebarOpen:c,closeSidebar:s,toogleSidebar:a}}(),views.settings=function(){"use strict";var e=document.getElementById("audio"),t=document.getElementById("audio-test"),i=document.getElementById("notifications"),n=document.getElementById("notifications-test"),r=document.getElementById("work-interval"),o=document.getElementById("break-interval"),s=document.getElementById("longbreak-interval"),a=document.getElementById("repeat"),c=document.getElementById("reset-settings");return{audio:e,audioTest:t,notifications:i,notificationsTest:n,workInterval:r,breakInterval:o,longbreakInterval:s,repeat:a,resetSettings:c}}();var sidebar=function(){"use strict";var e=function(){views.sidebar.getSidebarButton().addEventListener("click",views.sidebar.toogleSidebar),views.sidebar.getSidebarOverlay().addEventListener("click",views.sidebar.closeSidebar)};return{init:e}}(),settings=function(){"use strict";var e=function(e,t,i,n){var r=Math.floor(e);return r?1*t>r?r=t:r>1*i&&(r=i):r=n,r},t=function(){var t=services.storage.get("audio");null!==t&&(config.audio=t);var i=services.storage.get("notifications");null!==i&&(config.notifications=i),config.workInterval=services.storage.get("workInterval")||config.workInterval,config.breakInterval=services.storage.get("breakInterval")||config.breakInterval,config.longbreakInterval=services.storage.get("longbreakInterval")||config.longbreakInterval,config.repeat=services.storage.get("repeat")||config.repeat,views.settings.audio.checked=config.audio,views.settings.notifications.checked=config.notifications,views.settings.workInterval.value=config.workInterval/60,views.settings.breakInterval.value=config.breakInterval/60,views.settings.longbreakInterval.value=config.longbreakInterval/60,views.settings.repeat.value=config.repeat,views.settings.audio.addEventListener("click",function(){config.audio=this.checked,services.storage.set("audio",config.audio)}),views.settings.notifications.addEventListener("click",function(){config.notifications=this.checked,config.notifications===!0&&services.notification.requestPermission(),services.storage.set("notifications",config.notifications)}),views.settings.audioTest.addEventListener("click",function(){services.audio.play()}),views.settings.notificationsTest.addEventListener("click",function(){services.notification.newNotification("Web notification test","work")}),views.settings.workInterval.addEventListener("blur",function(){this.value=e(this.value,this.min,this.max,config.workInterval/60),config.workInterval=60*this.value,timer.updateIntervals(),services.storage.set("workInterval",config.workInterval)}),views.settings.breakInterval.addEventListener("blur",function(){this.value=e(this.value,this.min,this.max,config.breakInterval/60),config.breakInterval=60*this.value,timer.updateIntervals(),services.storage.set("breakInterval",config.breakInterval)}),views.settings.longbreakInterval.addEventListener("blur",function(){this.value=e(this.value,this.min,this.max,config.longbreakInterval/60),config.longbreakInterval=60*this.value,timer.updateIntervals(),services.storage.set("longbreakInterval",config.longbreakInterval)}),views.settings.repeat.addEventListener("input",function(){this.value=e(this.value,this.min,this.max,config.repeat),config.repeat=1*this.value,views.progress.removeImages(),timer.init(),services.storage.set("repeat",config.repeat)}),views.settings.resetSettings.addEventListener("click",function(){var e=confirm("Are you sure?");e&&(services.storage.clear(),location.reload(!1))}),config.notifications===!0&&services.notification.requestPermission()};return{init:t}}(),timer=function(){"use strict";var e,t,i,n=[],r=100,o=function(){s(),e=services.storage.get("intervalIndex")||0,t=services.storage.get("timerInterval")||config.workInterval,e>n.length-1&&(e=e%2===0?n.length-2:n.length-1);for(var i=0;i<config.repeat;i++)views.progress.createImage("unfinished");for(var r=0;e>=r;r++)u(r,!0);0===e&&t<config.workInterval&&(views.progress.setImageType("work",0),views.progress.setDescription("work")),0===e&&t===config.workInterval?services.title.resetTitle():services.title.setTitle(a(t)),views.controls.getStartButton().addEventListener("click",g),views.controls.getSkipButton().addEventListener("click",l),views.controls.getResetButton().addEventListener("click",m)},s=function(){n=[];for(var e=0;e<config.repeat;e++)n.push(config.workInterval),n.push(config.breakInterval);n.pop(),n.push(config.longbreakInterval)},a=function(e){var t=function(e){return 10>e&&(e="0"+e),e},i=Math.floor(e/60);return e%=60,t(i)+":"+t(e)},c=function(){t--,0>=t&&v();var e=a(t);views.timer.setTime(e),services.title.setTitle(e,i),services.storage.set("timerInterval",t)},v=function(r){r=r||!1,e++,e>n.length-1&&(e=0,m()),t=n[e],u(e,r),services.storage.set("intervalIndex",e),r&&(i&&(d(),f()),services.title.setTitle(a(t),i),services.storage.set("intervalIndex",e),services.storage.set("timerInterval",t))},u=function(e,i){var r=Math.floor(e/2);views.timer.setTime(a(t)),e===n.length-1?(services.favicon.setFavicon("longbreak"),!i&&config.notifications&&(services.notification.newNotification(config.longbreakInterval/60+" minute long break","longbreak"),services.audio.play()),views.progress.setDescription("long break"),views.progress.setImageType("longbreak",r)):0===e?(services.favicon.setFavicon("work"),i||(config.notifications&&services.notification.newNotification("Done","work"),config.audio&&services.audio.play())):e%2===0?(services.favicon.setFavicon("work"),i||(config.notifications&&services.notification.newNotification(config.workInterval/60+" minute work","work"),config.audio&&services.audio.play()),views.progress.setDescription("work"),views.progress.setImageType("work",r),views.progress.setImageType("finished",r-1)):e%2===1&&(services.favicon.setFavicon("break"),i||(config.notifications&&services.notification.newNotification(config.breakInterval/60+" minute break","break"),config.audio&&services.audio.play()),views.progress.setDescription("break"),views.progress.setImageType("break",r))},l=function(){v(!0)},g=function(){i?d():f(),services.title.setTitle(a(t),i),views.controls.toogleStartButtonCaption(),0===e&&(views.progress.setImageType("work",0),views.progress.setDescription("work"))},f=function(){var e=0,t=new Date;i=setInterval(function(){e+=(new Date).getTime()-t.getTime(),e>=1e3&&(c(),e-=1e3),t=new Date},r)},d=function(){i=clearInterval(i)},m=function(){d(),e=0,t=config.workInterval;var i=a(t);views.timer.setTime(i),views.controls.resetStartButton(),services.title.resetTitle(),services.favicon.setFavicon("work"),services.storage.set("intervalIndex",e),services.storage.set("timerInterval",t),views.progress.resetProgress()};return{init:o,updateIntervals:s,startTimer:g,pauseTimer:d,skipInterval:l,resetTimer:m}}(),hotkeys=function(){"use strict";var e={space:32,enter:13,esc:27,tab:9,r:82,s:83,h:72},t=function(){document.addEventListener("keydown",n)},i=function(){var e=document.querySelector(":focus");e&&e.blur()},n=function(t){switch(t=window.event||t,t.keyCode){case e.space:t.preventDefault(),timer.startTimer();break;case e.esc:views.sidebar.closeSidebar();break;case e.r:timer.resetTimer();break;case e.s:timer.skipInterval();break;case e.h:i(),views.sidebar.toogleSidebar();break;case e.tab:views.sidebar.isSidebarOpen()||t.preventDefault();break;case e.enter:t.preventDefault()}};return{init:t}}();!function(){"use strict";services.favicon.init(),services.audio.init(),settings.init(),sidebar.init(),timer.init(),hotkeys.init()}();